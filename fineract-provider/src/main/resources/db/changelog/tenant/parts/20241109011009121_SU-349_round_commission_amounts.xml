<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
    <changeSet author="fineract" id="4">
        <update tableName="stretchy_report">
            <column name="report_sql">
                <![CDATA[
                SELECT id                                   AS "ID",
           TO_CHAR(purchase_date, 'DD/MM/YYYY') AS "Fecha de Compra",
           nit                                  AS "NIT",
           client_ally_id                       AS "ID de Aliado del Cliente",
           company_name                         AS "Nombre de la Empresa",
           point_of_sales_id                    AS "ID del Punto de Venta",
           point_of_sales_name                  AS "Nombre del Punto de Venta",
           city_id                              AS "ID de la Ciudad",
           city_name                            AS "Nombre de la Ciudad",
           buy_amount                           AS "Monto de Compra",
           settled_comission                    AS "Comisión Liquidada",
           tax_profile_id                       AS "ID del Perfil Tributario",
           loan_id                              AS "ID del Préstamo",
           client_id                            AS "ID del Cliente",
           channel_id                           AS "ID del Canal",
           settlement_status                    AS "Estado de Liquidación",
           amount_comission                     AS "Monto de la Comisión",
           amount_va_commision 					AS "IVA de comisión",
           round(amount_to_pay,${decimalChoice})    AS "Total a pagar"
    FROM m_ally_purchase_settlement
    WHERE purchase_date BETWEEN '${startDate}' AND '${endDate}'
    ORDER BY purchase_date DESC
                ]]>
            </column>
            <column name="description" value="Informe de Liquidacion de Compras de Aliados"/>
            <where> report_name='Informe de Liquidacion de Compras de Aliados' </where>
        </update>
    </changeSet>
    <changeSet id="2" author="fineract">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM stretchy_parameter WHERE parameter_name = 'decimalSelected'
            </sqlCheck>
        </preConditions>
        <insert tableName="stretchy_parameter">
            <column name="parameter_name" value="decimalSelected"/>
            <column name="parameter_variable" value="decimalChoice"/>
            <column name="parameter_label" value="Lugares decimales"/>
            <column name="parameter_displayType" value="select"/>
            <column name="parameter_FormatType" value="n/a"/>
            <column name="parameter_default" value="0"/>
            <column name="special"/>
            <column name="selectOne"/>
            <column name="selectAll"/>
            <column name="parameter_sql">
                <![CDATA[
                select generate_series(0, 5) AS id, generate_series(0, 5) AS name
                ]]>
            </column>
            <column name="parent_id"/>
        </insert>
    </changeSet>
    <changeSet id="3" author="fineract">
        <insert tableName="stretchy_report_parameter">
            <column name="report_id"
                    valueComputed="(select id from stretchy_report where report_name = 'Informe de Liquidación de Compras de Aliados')"/>
            <column name="parameter_id"
                    valueComputed="(select id from stretchy_parameter where parameter_variable  = 'decimalChoice')"/>
            <column name="report_parameter_name" value="decimalSelected"/>
            <column name="mandatory_parameter" value="false"/>
        </insert>
    </changeSet>

</databaseChangeLog>
