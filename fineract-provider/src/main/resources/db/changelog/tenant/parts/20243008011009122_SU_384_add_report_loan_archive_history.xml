<?xml version="1.0" encoding="UTF-8"?>
<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements. See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership. The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License. You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied. See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
    <changeSet author="fineract" id="8">
        <preConditions onFail="MARK_RAN">
                <tableExists tableName="m_archive_loan_history"/>
            <not>
            <columnExists tableName="m_archive_loan_history" columnName="primer_apellido"/>
            </not>
        </preConditions>
        <addColumn tableName="m_archive_loan_history">
            <column name="primer_apellido" type="varchar(255)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="9" author="fineract">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                Select count(*) from stretchy_report where report_name = 'Daily Portfolio'
            </sqlCheck>
        </preConditions>
        <insert tableName="stretchy_report">
            <column name="report_name" value="Daily Portfolio"/>
            <column name="report_sql">
                <![CDATA[
    SELECT title AS "Descripcion",
    identificacion AS "Cedula del cliente",
    primer_nombre AS "Primer Nombre",
    segundo_nombre AS "Segundo Nombre",
    primer_apellido AS "Primer Apellido",
    segundo_apellido AS "Segundo Apellido",
    estado_cliente AS "Estado Cliente",
    numero_obligacion AS "Numero Cuenta Cuota",
    nit_empresa AS "Nit Empresa",
    telefono_sac_1 AS "Telefono",
    celular_sac_1 AS "Mobile No",
    telefono_sac_2 AS "Telefono Sac 2",
    celular_sac_2 AS "Celular Sac 2",
    email_sac AS "Email",
    direccion_sac AS "Direccion",
    barrio_sac AS "Barrio",
    ciudad_sac AS "Ciudad",
    departamento AS "Departamento",
    tipo_credito AS "Categoria punto de venta de origen del credito",
    fecha_vencimiento AS "Vencimiento cuota",
    dias_mora AS "Dias de mora de la cuenta",
    valor_cuota AS "Cuota",
    capital AS "Capital",
    aval AS "Aval",
    intereses AS "Intereses",
    intereses_de_mora AS "Intereses de mora",
    iva_interes_de_mora AS "IVA de mora",
    seguro AS "Seguro obligatorio cuota",
    seguros_voluntarios AS "Seguros voluntarios cuota",
    punto_de_venta AS "Punto de venta de origen del credito",
    tipo_documento AS "Tipo de documento",
    empresa AS "Empresa",
    marca AS "Nombre Aliado",
    razon_social AS "Nombre completo del cliente",
    ciudad_punto_credito AS "Ciudad punto de venta",
    estado_cuota AS "Estado de la cuenta",
    nombre_familiar_1 AS "Referencia del cliente",
    parentesco_familiar_1 AS "Parentesco referencia",
    celular_familiar_1 AS "Celular referencia",
    nombre_familiar_2 AS "Nombre familiar",
    parentesco_familiar_2 AS "Parentesco familiar",
    celular_familiar_2 AS "Celular familiar",
    fecha_financiacion AS "Fecha de desembolso",
    fecha_nacimiento AS "Fecha nacimiento cliente",
    genero AS "Genero cliente",
    empresa_labora AS "Nombre empresa donde labora",
    ingresos AS "Media de ingresos",
    periodicidad AS "Mensual",
    antiguedad_cliente AS "Fecha de creacion del cliente",
    empresa_reporta AS "Intercredito",
    abono AS "Abonos cuota",
    condonaciones AS "Condonaciones cuota",
    actividad_laboral AS "Actividad laboral del cliente",
    cre_estado AS "Estado cliente",
    cre_saldo AS "Saldo total del credito",
    cuo_saldo AS "Saldo total cuota",
    cuo_estado AS "Cuo Estado de la cuenta",
    estado_civil AS "Estado civil del cliente",
    numero_de_reprogramaciones AS "Numero de reprogramaciones" FROM m_archive_loan_history
                ]]>
            </column>
            <column name="report_type" value="Table"/>
            <column name="report_category" value="Loan"/>
            <column name="description" value="Reporte de Archivo de cartera"/>
            <column name="core_report" value="false"/>
            <column name="use_report" value="true"/>
        </insert>
        <insert tableName="stretchy_report_parameter">
            <column name="report_id"
                    valueComputed="(select id from stretchy_report where report_name = 'Daily Portfolio')"/>
            <column name="parameter_id"
                    valueComputed="5"/>
        </insert>
    </changeSet>
    <changeSet id="10" author="fineract">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM job WHERE name ='Archivo de cartera';
            </sqlCheck>
        </preConditions>
        <update tableName="job">
                <column name="currently_running" valueBoolean="true"/>
            <where>
                name ='Archivo de cartera'
            </where>
        </update>
    </changeSet>
</databaseChangeLog>
